## New Design Summary

**模块日志**
- 模块CGI操作日志：
  - 界面操作成功或失败都需要记录操作日志，注意失败操作日志采用拼接在描述信息之后；
  - 操作日志记录的信息按现有操作日志规范，包括：状态、操作人、操作主机、行为、对象、开始结束时间、描述；
    - 行为描述某一类操作，对象为被操作者，描述则是行为+对象（同一个对象可对应不同的行为）
- 模块异步任务日志：
  - 异步任务部分自动化功能操作，若操作结果前端可感知（可被查看），都需要记录操作日志，*需要区分操作人（本机和远程主机）*，便于区分是人为还是后台自动化
  操作结果，利于快速排障；
  - 异步任务为自动化执行业务，需要根据业务拆分子功能，记录执行过程中重要的步骤，便于快速定位排障；
  - 异步任务执行过程中，对于外部传入和计算所得的参数，需要日志记录，便于异常快速排障；

**模块异常**
- 异常处理注意如下几点：
  - 模块异常类型定位，识别模块所属层次，例如驱动、配置或业务等公共模块都有各自基类异常，正确定义模块异常类型，实现高可维护性，出现异常可快速定位；
  - 自定义异常类初始化需要同步初始化父类初始化函数，示例如下所示：
  ```
    def __init__(self. message):
        self.value = "{}".formate(message)
        super(xxx, self).__init__(message)
  ```
  - 不做异常捕获转换，除非需要对异常特殊处理，业务最外层需要兜底机制（CGI和异步任务包括兜底异常捕获处理机制）；
  - 捕获异常的逻辑尽可能短，过长需要考虑逻辑拆分；
  - 抛异常注意措辞，对于通用异常需要考虑描述信息可读性，同时包含异常点必要的参数信息，展示信息可精简，后台异常日志信息尽可能详细，便于快速排障；
    - 重点注意：CGI参数校验异常尽可能统一提示风格（结合业务可找PO或交互确定）
    - 措辞包括：操作功能、操作对象、操作参数
  
- 各模块基类异常：
  - Cssp基础异常：CsspBaseErr
  - 操作日志：OprlogBaseErr
  - 锁：CsspLockErr
  - 配置层：CpconfBaseErr
  - 驱动层：DriverBaseError
  - 节点层基类异常：NodeBaseError
  - 业务层基类异常：BusinessBaseErr

**模块数据及配置**
- 模块数据
  - 主要指模块关联的数据库表结构；
  - 新增数据库表
    - 评估是否模块必须可有替代方法，新增表会涉及db层、配置层添加接口至少包括增删改查，代码量偏多且增加业务操作复杂度，需要权衡利弊；
  - 旧表新增字段
	- 需要考虑新增字段类型及长度，是否满足正常和边界值场景；
	- 新增字段对原有查询逻辑影响，对查询数据量大小影响；

- 模块配置
  - 前端配置分：一次性、幂等性和变更对照三种格式，对于一次性参数全部采集前端输入提交，变更对比参数需要采集新旧数据一起下发，幂等性同一次性不同点是需要分析评估确定幂等计算参考项，供后台根据实际和配置自动处理新旧配置生效；
  - 主要指前后端交互数据和后端数据存储格式；
  - 前后端交互数据配置
	  - 根据前端交互输入，确定JSON配置格式，下发参数配置和获取配置同时考虑；
	  - 下发配置尽可能只包含前端输入或固定特性，禁止后台返回数据前端不做任何处理再次下发给前端（防篡改）；
  - 后端数据存储配置
	  - 配置只存储唯一不可变项（精简配置存储，少内存也是方便阅读），可变项在实际使用配置过程中实时获取，减少配置信息同步确保配置参数实时有效性；
  - 获取交互数据配置
	  - 因存储配置不包含可变项，需要根据配置已有参数实时获取，并且将实时数据转换成前端展示配置数据；
		- 该过程包括获取存储配置-》采集配置实时信息-》数据转换展示配置格式；
  
